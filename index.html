<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spark - From Thought to Action</title>
    <meta name="description" content="Capture fleeting thoughts and turn them into scheduled actions in 10 seconds. Built by Xin Gu (@ImAlexGu)">
    <meta name="author" content="Xin Gu">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://imalexgu.github.io/ai-scheduler/">
    <meta property="og:title" content="Spark - From Thought to Action">
    <meta property="og:description" content="10 seconds from fleeting thought to scheduled action">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:creator" content="@ImAlexGu">

    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; }
        @keyframes sparkle { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .sparkle { animation: sparkle 2s infinite; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Icons
        const Sparkles = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M12 3v18M3 12h18M7.5 7.5l9 9M16.5 7.5l-9 9"/>
            </svg>
        );

        const Calendar = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
        );

        const Clock = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
            </svg>
        );

        const CheckCircle = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
        );

        const Plus = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
        );

        const Twitter = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="currentColor" className={className}>
                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
            </svg>
        );

        const Vault = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
            </svg>
        );

        const Edit = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
        );

        const BarChart = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <line x1="12" y1="20" x2="12" y2="10"/>
                <line x1="18" y1="20" x2="18" y2="4"/>
                <line x1="6" y1="20" x2="6" y2="16"/>
            </svg>
        );

        const Settings = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <circle cx="12" cy="12" r="3"/>
                <path d="M12 1v6m0 6v6m5.2-13.2l-1.4 1.4m-7.6 7.6l-1.4 1.4m1.4-8.4l-1.4-1.4m7.6 7.6l1.4 1.4"/>
            </svg>
        );

        const DEFAULT_ROLES = [
            { id: 'self', name: 'Self', emoji: 'üéØ', color: 'bg-green-100 text-green-700 border-green-300' },
            { id: 'business', name: 'Business', emoji: 'üíº', color: 'bg-blue-100 text-blue-700 border-blue-300' }
        ];

        const EMOJI_OPTIONS = ['üë©‚Äç‚öïÔ∏è', '‚úçÔ∏è', 'üë™', 'üíº', 'üéØ', 'üé®', 'üìö', 'üí™', 'üßò', 'üëî', 'üç≥', 'üéµ', 'üíª', 'üå±', '‚≠ê'];

        // Google Calendar Configuration
        const GOOGLE_CLIENT_ID = 'YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com';
        const SCOPES = 'https://www.googleapis.com/auth/calendar.events';

        // Backend API URL
        const API_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
          ? 'http://localhost:3001'
          : 'https://your-backend-server.com';

        function SparkApp() {
          const [view, setView] = useState('main'); // main, vault, stats
          const [task, setTask] = useState('');
          const [duration, setDuration] = useState('1');
          const [priority, setPriority] = useState('medium');
          const [selectedRole, setSelectedRole] = useState(DEFAULT_ROLES[0]);
          const [analyzing, setAnalyzing] = useState(false);
          const [suggestions, setSuggestions] = useState(null);
          const [vaultItems, setVaultItems] = useState([]);
          const [customRoles, setCustomRoles] = useState([]);
          const [showAddRole, setShowAddRole] = useState(false);
          const [newRoleName, setNewRoleName] = useState('');
          const [newRoleEmoji, setNewRoleEmoji] = useState('‚≠ê');
          const [googleSignedIn, setGoogleSignedIn] = useState(false);
          const [accessToken, setAccessToken] = useState(null);
          const [taskHistory, setTaskHistory] = useState([]);
          const [claudeApiKey, setClaudeApiKey] = useState('');
          const [showSettings, setShowSettings] = useState(false);
          const [monthlyInsight, setMonthlyInsight] = useState(null);
          const [generatingInsight, setGeneratingInsight] = useState(false);

          // Load data from localStorage
          useEffect(() => {
            const savedVault = localStorage.getItem('sparkVault');
            if (savedVault) {
              setVaultItems(JSON.parse(savedVault));
            }

            const savedRoles = localStorage.getItem('sparkCustomRoles');
            if (savedRoles) {
              setCustomRoles(JSON.parse(savedRoles));
            }

            const savedHistory = localStorage.getItem('sparkTaskHistory');
            if (savedHistory) {
              setTaskHistory(JSON.parse(savedHistory));
            }

            const savedApiKey = localStorage.getItem('sparkClaudeApiKey');
            if (savedApiKey) {
              setClaudeApiKey(savedApiKey);
            }
          }, []);

          // Initialize Google Calendar API
          useEffect(() => {
            const initGoogleAPI = () => {
              if (typeof google !== 'undefined' && typeof gapi !== 'undefined') {
                gapi.load('client', () => {
                  gapi.client.init({
                    apiKey: '',
                    discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest'],
                  });
                });
              }
            };

            if (document.readyState === 'complete') {
              initGoogleAPI();
            } else {
              window.addEventListener('load', initGoogleAPI);
              return () => window.removeEventListener('load', initGoogleAPI);
            }
          }, []);

          const handleGoogleSignIn = () => {
            // Check if Google API is properly configured
            if (GOOGLE_CLIENT_ID === 'YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com') {
              alert('‚ö†Ô∏è Google Calendar is not configured yet.\n\nTo enable real Google Calendar integration:\n\n1. Get a Client ID from Google Cloud Console\n2. Replace GOOGLE_CLIENT_ID in the code (line 101)\n3. See CONFIG.md for detailed instructions\n\nFor now, you can use the calendar link option without login.');
              return;
            }

            if (typeof google === 'undefined' || !google.accounts) {
              alert('‚ö†Ô∏è Google API not loaded. Please refresh the page and try again.');
              return;
            }

            try {
              const client = google.accounts.oauth2.initTokenClient({
                client_id: GOOGLE_CLIENT_ID,
                scope: SCOPES,
                callback: (response) => {
                  if (response.access_token) {
                    setAccessToken(response.access_token);
                    setGoogleSignedIn(true);
                    gapi.client.setToken({ access_token: response.access_token });
                    alert('‚úÖ Successfully connected to Google Calendar!');
                  } else if (response.error) {
                    alert('‚ùå Google sign-in failed: ' + response.error);
                  }
                },
              });
              client.requestAccessToken();
            } catch (error) {
              console.error('Google sign-in error:', error);
              alert('‚ùå Failed to initialize Google sign-in. Please check your configuration.');
            }
          };

          const handleGoogleSignOut = () => {
            google.accounts.oauth2.revoke(accessToken, () => {
              setAccessToken(null);
              setGoogleSignedIn(false);
              gapi.client.setToken(null);
            });
          };

          const createGoogleCalendarEvent = async (startTime, endTime) => {
            if (!googleSignedIn || !accessToken) {
              alert('Please sign in with Google Calendar first!');
              return;
            }

            const event = {
              summary: `${selectedRole.emoji} ${task}`,
              description: `Role: ${selectedRole.name}\nPriority: ${priority}\n\nCreated by Spark ‚ö°\nhttps://imalexgu.github.io/ai-scheduler/`,
              start: {
                dateTime: startTime.toISOString(),
                timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone,
              },
              end: {
                dateTime: endTime.toISOString(),
                timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone,
              },
            };

            try {
              const response = await gapi.client.calendar.events.insert({
                calendarId: 'primary',
                resource: event,
              });

              saveToHistory(startTime);
              alert('‚úÖ Event created successfully in your Google Calendar!');
              resetForm();
              return response;
            } catch (error) {
              console.error('Error creating event:', error);
              alert('‚ùå Failed to create event. Please try again.');
            }
          };

          const addCustomRole = () => {
            if (!newRoleName.trim()) {
              alert('Please enter a role name');
              return;
            }

            const colors = [
              'bg-purple-100 text-purple-700 border-purple-300',
              'bg-blue-100 text-blue-700 border-blue-300',
              'bg-pink-100 text-pink-700 border-pink-300',
              'bg-green-100 text-green-700 border-green-300',
              'bg-yellow-100 text-yellow-700 border-yellow-300',
              'bg-red-100 text-red-700 border-red-300',
            ];

            const newRole = {
              id: `custom-${Date.now()}`,
              name: newRoleName.trim(),
              emoji: newRoleEmoji,
              color: colors[customRoles.length % colors.length],
              custom: true
            };

            const updated = [...customRoles, newRole];
            setCustomRoles(updated);
            localStorage.setItem('sparkCustomRoles', JSON.stringify(updated));

            setSelectedRole(newRole);
            setNewRoleName('');
            setNewRoleEmoji('‚≠ê');
            setShowAddRole(false);
          };

          const deleteCustomRole = (roleId) => {
            const updated = customRoles.filter(r => r.id !== roleId);
            setCustomRoles(updated);
            localStorage.setItem('sparkCustomRoles', JSON.stringify(updated));

            if (selectedRole.id === roleId) {
              setSelectedRole(DEFAULT_ROLES[0]);
            }
          };

          const allRoles = [...DEFAULT_ROLES, ...customRoles];

          const saveToHistory = (scheduledTime) => {
            const historyItem = {
              id: Date.now(),
              task,
              duration: parseFloat(duration),
              priority,
              role: selectedRole,
              createdDate: new Date().toISOString(),
              scheduledDate: scheduledTime.toISOString()
            };

            const updated = [...taskHistory, historyItem];
            setTaskHistory(updated);
            localStorage.setItem('sparkTaskHistory', JSON.stringify(updated));
          };

          const saveToVault = () => {
            const newItem = {
              id: Date.now(),
              task,
              duration,
              priority,
              role: selectedRole,
              addedDate: new Date().toISOString()
            };
            const updated = [...vaultItems, newItem];
            setVaultItems(updated);
            localStorage.setItem('sparkVault', JSON.stringify(updated));
            setTask('');
            alert('üíé Saved to Spark Vault!\n\nWe\'ll remind you to review this later.');
          };

          const deleteFromVault = (id) => {
            const updated = vaultItems.filter(item => item.id !== id);
            setVaultItems(updated);
            localStorage.setItem('sparkVault', JSON.stringify(updated));
          };

          const scheduleFromVault = (item) => {
            setTask(item.task);
            setDuration(item.duration);
            setPriority(item.priority);
            setSelectedRole(item.role);
            setView('main');
            deleteFromVault(item.id);
          };

          const analyzeTask = async () => {
            if (priority === 'now') {
              const now = new Date();
              const durationMinutes = parseFloat(duration) * 60;
              const endTime = new Date(now.getTime() + durationMinutes * 60 * 1000);

              if (googleSignedIn) {
                await createGoogleCalendarEvent(now, endTime);
              } else {
                const formatDateTime = (date) => {
                  return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
                };

                const params = new URLSearchParams({
                  action: 'TEMPLATE',
                  text: `${selectedRole.emoji} ${task}`,
                  dates: `${formatDateTime(now)}/${formatDateTime(endTime)}`,
                  details: `Role: ${selectedRole.name}\nPriority: Do Now!\n\nCreated by Spark ‚ö°\nhttps://imalexgu.github.io/ai-scheduler/`,
                  location: ''
                });

                const calendarLink = `https://calendar.google.com/calendar/render?${params.toString()}`;
                window.open(calendarLink, '_blank');

                alert('‚ö° Ready to go!\n\nOpening Google Calendar to block your time right now.\n\nLet\'s do this!');
                resetForm();
              }
              return;
            }

            setAnalyzing(true);

            try {
              const response = await fetch(`${API_URL}/api/analyze-task`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  task,
                  duration,
                  priority,
                  roles: [selectedRole],
                  timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
                })
              });

              if (!response.ok) throw new Error('Failed to get AI suggestions');

              const data = await response.json();
              const suggestions = data.suggestions.map(s => ({
                ...s,
                time: new Date(s.time)
              }));

              setSuggestions(suggestions.slice(0, 3));

            } catch (error) {
              console.error('Error getting AI suggestions:', error);

              const now = new Date();
              const suggestions = [];

              const tomorrow9am = new Date(now);
              tomorrow9am.setDate(tomorrow9am.getDate() + 1);
              tomorrow9am.setHours(9, 0, 0, 0);

              suggestions.push({
                time: tomorrow9am,
                reason: `Optimal for ${selectedRole.name} tasks - morning energy peak`,
                score: 95,
                roleMatch: true
              });

              const today2pm = new Date(now);
              today2pm.setHours(14, 0, 0, 0);
              if (today2pm > now) {
                suggestions.push({
                  time: today2pm,
                  reason: 'Available today, good productivity window',
                  score: 85,
                  roleMatch: true
                });
              }

              const dayAfter10am = new Date(now);
              dayAfter10am.setDate(dayAfter10am.getDate() + 2);
              dayAfter10am.setHours(10, 0, 0, 0);

              suggestions.push({
                time: dayAfter10am,
                reason: 'Extra time to prepare, flexible schedule',
                score: 80,
                roleMatch: false
              });

              setSuggestions(suggestions.slice(0, 3));
            }

            setAnalyzing(false);
          };

          const generateCalendarLink = (suggestion) => {
            const startTime = suggestion.time;
            const durationMinutes = parseFloat(duration) * 60;
            const endTime = new Date(startTime.getTime() + durationMinutes * 60 * 1000);

            const formatDateTime = (date) => {
              return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
            };

            const params = new URLSearchParams({
              action: 'TEMPLATE',
              text: `${selectedRole.emoji} ${task}`,
              dates: `${formatDateTime(startTime)}/${formatDateTime(endTime)}`,
              details: `Role: ${selectedRole.name}\nPriority: ${priority}\n\nCreated by Spark ‚ö°\nhttps://imalexgu.github.io/ai-scheduler/`,
              location: ''
            });

            return `https://calendar.google.com/calendar/render?${params.toString()}`;
          };

          const formatDateTime = (date) => {
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);

            let dayLabel = '';
            if (date.toDateString() === today.toDateString()) {
              dayLabel = 'Today';
            } else if (date.toDateString() === tomorrow.toDateString()) {
              dayLabel = 'Tomorrow';
            } else {
              dayLabel = days[date.getDay()];
            }

            return {
              date: `${months[date.getMonth()]} ${date.getDate()}, ${dayLabel}`,
              time: `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`
            };
          };

          const resetForm = () => {
            setTask('');
            setDuration('1');
            setPriority('medium');
            setSuggestions(null);
          };

          const shareOnTwitter = () => {
            const text = "I'm using Spark ‚ö° to turn fleeting thoughts into scheduled actions in 10 seconds!";
            const url = "https://imalexgu.github.io/ai-scheduler/";
            const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}&via=ImAlexGu`;
            window.open(twitterUrl, '_blank');
          };

          // Main View
          if (view === 'main') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-50 p-4 md:p-8">
                <div className="max-w-4xl mx-auto">
                  {/* Header */}
                  <div className="bg-white rounded-3xl shadow-xl p-6 md:p-8 mb-6">
                    <div className="flex items-center justify-between mb-2">
                      <div className="flex items-center gap-3">
                        <div className="bg-gradient-to-br from-purple-500 to-blue-500 p-3 rounded-2xl sparkle">
                          <Sparkles size={28} className="text-white" />
                        </div>
                        <div>
                          <h1 className="text-2xl md:text-3xl font-bold text-gray-800">
                            Spark
                          </h1>
                          <p className="text-gray-500 text-sm">From thought to action in 10 seconds</p>
                        </div>
                      </div>
                      <div className="flex items-center gap-2">
                        <button
                          onClick={() => setView('stats')}
                          className="relative p-2 hover:bg-green-50 rounded-lg transition text-green-600"
                          title="Monthly Stats"
                        >
                          <BarChart size={24} />
                        </button>
                        <button
                          onClick={() => setView('vault')}
                          className="relative p-2 hover:bg-purple-50 rounded-lg transition text-purple-600"
                          title="Spark Vault"
                        >
                          <Vault size={24} />
                          {vaultItems.length > 0 && (
                            <span className="absolute -top-1 -right-1 bg-purple-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
                              {vaultItems.length}
                            </span>
                          )}
                        </button>
                        {googleSignedIn ? (
                          <button
                            onClick={handleGoogleSignOut}
                            className="px-3 py-1.5 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition text-sm font-medium"
                            title="Google Calendar Connected"
                          >
                            ‚úì Google
                          </button>
                        ) : (
                          <button
                            onClick={handleGoogleSignIn}
                            className="px-3 py-1.5 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition text-sm font-medium"
                            title="Connect Google Calendar"
                          >
                            Login Google
                          </button>
                        )}
                        <button
                          onClick={shareOnTwitter}
                          className="p-2 hover:bg-blue-50 rounded-lg transition text-blue-500"
                          title="Share on X"
                        >
                          <Twitter size={24} />
                        </button>
                        <button
                          onClick={() => setShowSettings(true)}
                          className="p-2 hover:bg-gray-50 rounded-lg transition text-gray-600"
                          title="Settings"
                        >
                          <Settings size={24} />
                        </button>
                      </div>
                    </div>
                  </div>

                  {/* Main Form */}
                  <div className="bg-white rounded-3xl shadow-xl p-6 md:p-8 mb-6">
                    <div className="space-y-6">
                      {/* Role Selection */}
                      <div>
                        <div className="flex items-center justify-between mb-2">
                          <label className="block text-sm font-semibold text-gray-700">
                            üé≠ Which role is this for?
                          </label>
                          <button
                            onClick={() => setShowAddRole(!showAddRole)}
                            className="text-xs text-purple-600 hover:text-purple-700 flex items-center gap-1"
                          >
                            <Plus size={14} />
                            Add Custom Role
                          </button>
                        </div>

                        {showAddRole && (
                          <div className="mb-4 p-4 bg-purple-50 rounded-xl">
                            <div className="space-y-3">
                              <div>
                                <label className="text-xs text-gray-600 block mb-1">Role Name</label>
                                <input
                                  type="text"
                                  value={newRoleName}
                                  onChange={(e) => setNewRoleName(e.target.value)}
                                  placeholder="e.g., Entrepreneur, Student..."
                                  className="w-full px-3 py-2 border border-purple-200 rounded-lg text-sm"
                                />
                              </div>
                              <div>
                                <label className="text-xs text-gray-600 block mb-1">Choose Emoji</label>
                                <div className="flex flex-wrap gap-2">
                                  {EMOJI_OPTIONS.map(emoji => (
                                    <button
                                      key={emoji}
                                      onClick={() => setNewRoleEmoji(emoji)}
                                      className={`text-2xl p-2 rounded-lg border-2 transition ${
                                        newRoleEmoji === emoji
                                          ? 'border-purple-500 bg-purple-100'
                                          : 'border-gray-200 hover:border-purple-300'
                                      }`}
                                    >
                                      {emoji}
                                    </button>
                                  ))}
                                </div>
                              </div>
                              <div className="flex gap-2">
                                <button
                                  onClick={addCustomRole}
                                  className="flex-1 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition text-sm font-medium"
                                >
                                  Save Role
                                </button>
                                <button
                                  onClick={() => setShowAddRole(false)}
                                  className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition text-sm"
                                >
                                  Cancel
                                </button>
                              </div>
                            </div>
                          </div>
                        )}

                        <div className="flex flex-wrap gap-2">
                          {allRoles.map(role => (
                            <div key={role.id} className="relative group">
                              <button
                                onClick={() => setSelectedRole(role)}
                                className={`px-4 py-2 rounded-xl border-2 transition-all ${
                                  selectedRole.id === role.id
                                    ? role.color + ' scale-105 shadow-md'
                                    : 'bg-white text-gray-600 border-gray-200 hover:border-gray-300'
                                }`}
                              >
                                <span className="mr-2">{role.emoji}</span>
                                {role.name}
                              </button>
                              {role.custom && (
                                <button
                                  onClick={() => deleteCustomRole(role.id)}
                                  className="absolute -top-2 -right-2 w-5 h-5 bg-red-500 text-white rounded-full text-xs opacity-0 group-hover:opacity-100 transition"
                                  title="Delete custom role"
                                >
                                  √ó
                                </button>
                              )}
                            </div>
                          ))}
                        </div>
                      </div>

                      {/* Task Input */}
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">
                          üí≠ What sparked in your mind?
                        </label>
                        <textarea
                          value={task}
                          onChange={(e) => setTask(e.target.value)}
                          placeholder="e.g., Email teacher about math project, Prepare supervision materials..."
                          className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none"
                          rows="3"
                        />
                      </div>

                      {/* Duration and Priority */}
                      <div className="grid md:grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-semibold text-gray-700 mb-2">
                            ‚è±Ô∏è How long?
                          </label>
                          <select
                            value={duration}
                            onChange={(e) => setDuration(e.target.value)}
                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                          >
                            <option value="0.167">10 minutes</option>
                            <option value="0.5">30 minutes</option>
                            <option value="1">1 hour</option>
                            <option value="2">2 hours</option>
                          </select>
                        </div>

                        <div>
                          <label className="block text-sm font-semibold text-gray-700 mb-2">
                            üéØ Priority
                          </label>
                          <select
                            value={priority}
                            onChange={(e) => setPriority(e.target.value)}
                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                          >
                            <option value="now">‚ö° Do Now! (Start immediately)</option>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                          </select>
                        </div>
                      </div>

                      {/* Action Buttons */}
                      <div className="flex gap-3">
                        <button
                          onClick={analyzeTask}
                          disabled={!task.trim() || analyzing}
                          className={`flex-1 py-4 rounded-xl font-semibold text-lg transition-all transform ${
                            task.trim() && !analyzing
                              ? priority === 'now'
                                ? 'bg-gradient-to-r from-orange-500 to-red-500 text-white hover:scale-105 shadow-lg hover:shadow-xl animate-pulse'
                                : 'bg-gradient-to-r from-purple-500 to-blue-500 text-white hover:scale-105 shadow-lg hover:shadow-xl'
                              : 'bg-gray-200 text-gray-400 cursor-not-allowed'
                          }`}
                        >
                          {analyzing ? (
                            <span className="flex items-center justify-center gap-2">
                              <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
                              AI is analyzing...
                            </span>
                          ) : priority === 'now' ? (
                            <span className="flex items-center justify-center gap-2">
                              ‚ö° Do It Now!
                            </span>
                          ) : (
                            <span className="flex items-center justify-center gap-2">
                              <Sparkles size={20} />
                              Find Best Time
                            </span>
                          )}
                        </button>

                        <button
                          onClick={saveToVault}
                          disabled={!task.trim() || priority === 'now'}
                          className={`px-6 py-4 rounded-xl font-semibold transition-all ${
                            task.trim() && priority !== 'now'
                              ? 'bg-purple-100 text-purple-700 hover:bg-purple-200'
                              : 'bg-gray-100 text-gray-400 cursor-not-allowed'
                          }`}
                          title="Save to Vault"
                        >
                          <Vault size={24} />
                        </button>
                      </div>

                      <p className="text-xs text-gray-500 text-center">
                        {priority === 'now'
                          ? '‚ö° "Do Now" will open Google Calendar immediately to block your time'
                          : 'Not sure yet? Save to Vault üíé and decide later'
                        }
                      </p>
                    </div>

                    {/* Suggestions */}
                    {suggestions && (
                      <div className="mt-8 space-y-4">
                        <div className="flex items-center justify-between">
                          <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2">
                            <Calendar size={24} className="text-purple-500" />
                            3 Best Time Options
                          </h2>
                          <button
                            onClick={resetForm}
                            className="text-sm text-gray-500 hover:text-gray-700 flex items-center gap-1"
                          >
                            <Plus size={16} />
                            New Spark
                          </button>
                        </div>

                        <div className="p-4 bg-blue-50 rounded-xl mb-4">
                          <p className="text-sm text-gray-700">
                            <strong>üí° Psychology Tip:</strong> Research shows that committing to a specific time
                            increases follow-through by 70%. Choose your time and commit!
                          </p>
                        </div>

                        {suggestions.map((suggestion, idx) => {
                          const datetime = formatDateTime(suggestion.time);
                          const endDatetime = formatDateTime(
                            new Date(suggestion.time.getTime() + parseFloat(duration) * 60 * 60 * 1000)
                          );
                          return (
                            <div
                              key={idx}
                              className={`border-2 rounded-2xl p-6 transition-all hover:shadow-lg ${
                                idx === 0
                                  ? 'border-green-400 bg-green-50'
                                  : 'border-gray-200 bg-white hover:border-purple-300'
                              }`}
                            >
                              <div className="flex items-start justify-between mb-3">
                                <div className="flex-1">
                                  <div className="flex items-center gap-2 mb-2">
                                    {idx === 0 && (
                                      <span className="bg-green-500 text-white text-xs font-bold px-2 py-1 rounded-full">
                                        BEST MATCH
                                      </span>
                                    )}
                                    <span className="text-2xl font-bold text-gray-800">
                                      {datetime.date}
                                    </span>
                                  </div>
                                  <div className="flex items-center gap-3 text-gray-600">
                                    <Clock size={18} />
                                    <span className="text-xl font-semibold">
                                      {datetime.time} - {endDatetime.time}
                                    </span>
                                  </div>
                                </div>
                                <div className="text-right">
                                  <div className="text-3xl font-bold text-purple-600">
                                    {suggestion.score}
                                  </div>
                                  <div className="text-xs text-gray-500">Match Score</div>
                                </div>
                              </div>

                              <div className="flex items-center gap-2 mb-3">
                                <span className={`px-3 py-1 rounded-full text-sm ${selectedRole.color}`}>
                                  {selectedRole.emoji} {selectedRole.name}
                                </span>
                              </div>

                              <p className="text-gray-600 mb-4 flex items-center gap-2">
                                <span className="text-blue-500">üí°</span>
                                {suggestion.reason}
                              </p>

                              {googleSignedIn ? (
                                <button
                                  onClick={async () => {
                                    const startTime = suggestion.time;
                                    const durationMinutes = parseFloat(duration) * 60;
                                    const endTime = new Date(startTime.getTime() + durationMinutes * 60 * 1000);
                                    await createGoogleCalendarEvent(startTime, endTime);
                                  }}
                                  className={`w-full py-3 rounded-xl font-semibold text-center transition-all ${
                                    idx === 0
                                      ? 'bg-green-500 text-white hover:bg-green-600 shadow-md hover:shadow-lg'
                                      : 'bg-purple-500 text-white hover:bg-purple-600'
                                  }`}
                                >
                                  <span className="flex items-center justify-center gap-2">
                                    <CheckCircle size={20} />
                                    Add to Calendar
                                  </span>
                                </button>
                              ) : (
                                <a
                                  href={generateCalendarLink(suggestion)}
                                  target="_blank"
                                  rel="noopener noreferrer"
                                  className={`block w-full py-3 rounded-xl font-semibold text-center transition-all ${
                                    idx === 0
                                      ? 'bg-green-500 text-white hover:bg-green-600 shadow-md hover:shadow-lg'
                                      : 'bg-purple-500 text-white hover:bg-purple-600'
                                  }`}
                                >
                                  <span className="flex items-center justify-center gap-2">
                                    <CheckCircle size={20} />
                                    Open Calendar Link
                                  </span>
                                </a>
                              )}
                            </div>
                          );
                        })}
                      </div>
                    )}
                  </div>

                  {/* Footer */}
                  <div className="bg-white rounded-2xl shadow-lg p-6 text-center">
                    <div className="flex flex-col items-center gap-4">
                      <div className="text-gray-600">
                        <p className="text-sm mb-2">‚ö° v3.0 | Custom roles + AI suggestions</p>
                        <p className="font-semibold text-gray-800">
                          Made by <span className="text-purple-600">Xin Gu</span>
                        </p>
                      </div>
                      <div className="flex items-center gap-4">
                        <a
                          href="https://twitter.com/ImAlexGu"
                          target="_blank"
                          rel="noopener noreferrer"
                          className="flex items-center gap-2 text-blue-500 hover:text-blue-600 transition"
                        >
                          <Twitter size={20} />
                          <span className="text-sm font-medium">@ImAlexGu</span>
                        </a>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Settings Modal */}
                {showSettings && (
                  <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div className="bg-white rounded-3xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                      <div className="p-6 md:p-8">
                        <div className="flex items-center justify-between mb-6">
                          <div className="flex items-center gap-3">
                            <Settings size={32} className="text-gray-600" />
                            <h2 className="text-2xl font-bold text-gray-800">Settings</h2>
                          </div>
                          <button
                            onClick={() => setShowSettings(false)}
                            className="text-gray-400 hover:text-gray-600 text-3xl"
                          >
                            √ó
                          </button>
                        </div>

                        <div className="space-y-6">
                          {/* Claude API Key */}
                          <div>
                            <label className="block text-sm font-semibold text-gray-700 mb-2">
                              ü§ñ Claude API Key
                            </label>
                            <input
                              type="password"
                              value={claudeApiKey}
                              onChange={(e) => {
                                setClaudeApiKey(e.target.value);
                                localStorage.setItem('sparkClaudeApiKey', e.target.value);
                              }}
                              placeholder="sk-ant-..."
                              className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                            />
                            <p className="text-xs text-gray-500 mt-2">
                              Get your API key from <a href="https://console.anthropic.com/" target="_blank" className="text-purple-600 hover:underline">console.anthropic.com</a>
                            </p>
                            {claudeApiKey && (
                              <p className="text-xs text-green-600 mt-1 flex items-center gap-1">
                                ‚úì API key configured
                              </p>
                            )}
                          </div>

                          {/* Google Client ID Info */}
                          <div>
                            <label className="block text-sm font-semibold text-gray-700 mb-2">
                              üóìÔ∏è Google Calendar Client ID
                            </label>
                            <input
                              type="text"
                              value={GOOGLE_CLIENT_ID}
                              readOnly
                              className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl bg-gray-50 text-gray-600"
                            />
                            <p className="text-xs text-gray-500 mt-2">
                              {GOOGLE_CLIENT_ID === 'YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com'
                                ? '‚ö†Ô∏è Not configured. See CONFIG.md for setup instructions.'
                                : '‚úì Client ID configured'}
                            </p>
                          </div>

                          {/* Backend API URL Info */}
                          <div>
                            <label className="block text-sm font-semibold text-gray-700 mb-2">
                              üîó Backend API URL
                            </label>
                            <input
                              type="text"
                              value={API_URL}
                              readOnly
                              className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl bg-gray-50 text-gray-600"
                            />
                            <p className="text-xs text-gray-500 mt-2">
                              Backend server for AI analysis. See README for deployment guide.
                            </p>
                          </div>

                          {/* Data Storage */}
                          <div className="bg-blue-50 p-4 rounded-xl">
                            <div className="font-semibold text-gray-800 mb-2">üìä Data Storage</div>
                            <div className="text-sm text-gray-600 space-y-1">
                              <div>‚Ä¢ Tasks: {taskHistory.length} completed</div>
                              <div>‚Ä¢ Vault: {vaultItems.length} saved</div>
                              <div>‚Ä¢ Custom Roles: {customRoles.length}</div>
                              <div className="text-xs text-gray-500 mt-2">
                                All data stored locally in your browser
                              </div>
                            </div>
                          </div>

                          {/* Actions */}
                          <div className="flex gap-3">
                            <button
                              onClick={() => {
                                if (confirm('Clear all task history? This cannot be undone.')) {
                                  setTaskHistory([]);
                                  localStorage.removeItem('sparkTaskHistory');
                                  alert('Task history cleared');
                                }
                              }}
                              className="flex-1 py-3 bg-red-100 text-red-700 rounded-xl hover:bg-red-200 transition font-medium"
                            >
                              Clear History
                            </button>
                            <button
                              onClick={() => setShowSettings(false)}
                              className="flex-1 py-3 bg-purple-500 text-white rounded-xl hover:bg-purple-600 transition font-medium"
                            >
                              Done
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            );
          }

          // Vault View
          if (view === 'vault') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-50 p-4 md:p-8">
                <div className="max-w-4xl mx-auto">
                  <div className="bg-white rounded-3xl shadow-xl p-6 md:p-8">
                    <div className="flex items-center justify-between mb-6">
                      <div className="flex items-center gap-3">
                        <Vault size={32} className="text-purple-600" />
                        <div>
                          <h1 className="text-2xl font-bold text-gray-800">Spark Vault</h1>
                          <p className="text-gray-500 text-sm">Ideas you're still considering</p>
                        </div>
                      </div>
                      <button
                        onClick={() => setView('main')}
                        className="px-4 py-2 bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 transition"
                      >
                        Back
                      </button>
                    </div>

                    {vaultItems.length === 0 ? (
                      <div className="text-center py-12">
                        <Vault size={64} className="text-gray-300 mx-auto mb-4" />
                        <p className="text-gray-500 text-lg mb-2">Your Vault is empty</p>
                        <p className="text-gray-400 text-sm">Save ideas here when you're not ready to commit time yet</p>
                      </div>
                    ) : (
                      <div className="space-y-4">
                        {vaultItems.map(item => {
                          const daysAgo = Math.floor((Date.now() - new Date(item.addedDate).getTime()) / (1000 * 60 * 60 * 24));
                          return (
                            <div key={item.id} className="border-2 border-gray-200 rounded-xl p-4 hover:border-purple-300 transition">
                              <div className="flex items-start justify-between mb-2">
                                <div className="flex-1">
                                  <div className="flex items-center gap-2 mb-2">
                                    <span className={`px-3 py-1 rounded-full text-sm ${item.role.color}`}>
                                      {item.role.emoji} {item.role.name}
                                    </span>
                                  </div>
                                  <p className="text-gray-800 font-medium">{item.task}</p>
                                  <p className="text-sm text-gray-500">
                                    Added {daysAgo === 0 ? 'today' : `${daysAgo} day${daysAgo > 1 ? 's' : ''} ago`} ‚Ä¢ {item.duration}h ‚Ä¢ {item.priority} priority
                                  </p>
                                </div>
                              </div>
                              <div className="flex gap-2 mt-3">
                                <button
                                  onClick={() => scheduleFromVault(item)}
                                  className="flex-1 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition"
                                >
                                  Schedule Now
                                </button>
                                <button
                                  onClick={() => deleteFromVault(item.id)}
                                  className="px-4 py-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition"
                                >
                                  Delete
                                </button>
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    )}
                  </div>
                </div>
              </div>
            );
          }

          // Monthly Stats View
          if (view === 'stats') {
            // Calculate monthly statistics
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();

            const monthlyTasks = taskHistory.filter(item => {
              const itemDate = new Date(item.scheduledDate);
              return itemDate.getMonth() === currentMonth && itemDate.getFullYear() === currentYear;
            });

            const generateMonthlyInsight = async () => {
              if (!claudeApiKey) {
                alert('‚ö†Ô∏è Please configure your Claude API key in Settings first.');
                setShowSettings(true);
                return;
              }

              if (monthlyTasks.length === 0) {
                alert('No tasks this month to analyze!');
                return;
              }

              setGeneratingInsight(true);

              try {
                const taskDescriptions = monthlyTasks.map(t => t.task).join('\n- ');
                const roleBreakdown = sortedRoles.map(r => `${r.emoji} ${r.name}: ${r.count} tasks, ${r.totalHours.toFixed(1)} hours`).join('\n');

                const prompt = `Analyze this month's tasks and provide insights:

Monthly Tasks (${monthlyTasks.length} total):
- ${taskDescriptions}

Role Distribution:
${roleBreakdown}

Please provide:
1. Top 5 keywords that describe this month's focus
2. A brief user profile (2-3 sentences) based on task patterns
3. One personalized recommendation for next month

Format as JSON:
{
  "keywords": ["keyword1", "keyword2", "keyword3", "keyword4", "keyword5"],
  "profile": "Your profile text...",
  "recommendation": "Your recommendation..."
}`;

                const response = await fetch('https://api.anthropic.com/v1/messages', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json',
                    'x-api-key': claudeApiKey,
                    'anthropic-version': '2023-06-01'
                  },
                  body: JSON.stringify({
                    model: 'claude-3-5-sonnet-20241022',
                    max_tokens: 1024,
                    messages: [{
                      role: 'user',
                      content: prompt
                    }]
                  })
                });

                if (!response.ok) {
                  throw new Error('Failed to get insights from Claude API');
                }

                const data = await response.json();
                const insightText = data.content[0].text;
                const insight = JSON.parse(insightText);

                setMonthlyInsight(insight);
              } catch (error) {
                console.error('Error generating insight:', error);
                alert('‚ùå Failed to generate insights. Please check your API key and try again.');
              }

              setGeneratingInsight(false);
            };

            // Calculate role statistics
            const roleStats = {};
            allRoles.forEach(role => {
              roleStats[role.id] = {
                name: role.name,
                emoji: role.emoji,
                color: role.color,
                count: 0,
                totalHours: 0
              };
            });

            monthlyTasks.forEach(task => {
              if (task.role && roleStats[task.role.id]) {
                roleStats[task.role.id].count++;
                roleStats[task.role.id].totalHours += task.duration;
              }
            });

            const sortedRoles = Object.values(roleStats)
              .filter(stat => stat.count > 0)
              .sort((a, b) => b.totalHours - a.totalHours);

            const totalHours = monthlyTasks.reduce((sum, task) => sum + task.duration, 0);
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                               'July', 'August', 'September', 'October', 'November', 'December'];

            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-50 p-4 md:p-8">
                <div className="max-w-4xl mx-auto">
                  <div className="bg-white rounded-3xl shadow-xl p-6 md:p-8">
                    <div className="flex items-center justify-between mb-6">
                      <div className="flex items-center gap-3">
                        <BarChart size={32} className="text-green-600" />
                        <div>
                          <h1 className="text-2xl font-bold text-gray-800">Monthly Stats</h1>
                          <p className="text-gray-500 text-sm">{monthNames[currentMonth]} {currentYear}</p>
                        </div>
                      </div>
                      <button
                        onClick={() => setView('main')}
                        className="px-4 py-2 bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 transition"
                      >
                        Back
                      </button>
                    </div>

                    {monthlyTasks.length === 0 ? (
                      <div className="text-center py-12">
                        <BarChart size={64} className="text-gray-300 mx-auto mb-4" />
                        <p className="text-gray-500 text-lg mb-2">No tasks scheduled this month yet</p>
                        <p className="text-gray-400 text-sm">Start scheduling tasks to see your monthly insights!</p>
                      </div>
                    ) : (
                      <div className="space-y-6">
                        {/* Summary Cards */}
                        <div className="grid md:grid-cols-3 gap-4">
                          <div className="bg-gradient-to-br from-purple-100 to-purple-200 p-6 rounded-2xl">
                            <div className="text-purple-700 text-sm font-semibold mb-1">Total Tasks</div>
                            <div className="text-4xl font-bold text-purple-900">{monthlyTasks.length}</div>
                          </div>
                          <div className="bg-gradient-to-br from-blue-100 to-blue-200 p-6 rounded-2xl">
                            <div className="text-blue-700 text-sm font-semibold mb-1">Total Hours</div>
                            <div className="text-4xl font-bold text-blue-900">{totalHours.toFixed(1)}</div>
                          </div>
                          <div className="bg-gradient-to-br from-green-100 to-green-200 p-6 rounded-2xl">
                            <div className="text-green-700 text-sm font-semibold mb-1">Active Roles</div>
                            <div className="text-4xl font-bold text-green-900">{sortedRoles.length}</div>
                          </div>
                        </div>

                        {/* Role Breakdown */}
                        <div className="bg-gray-50 p-6 rounded-2xl">
                          <h2 className="text-xl font-bold text-gray-800 mb-4">Role Distribution</h2>
                          <div className="space-y-3">
                            {sortedRoles.map(role => {
                              const percentage = (role.totalHours / totalHours * 100).toFixed(1);
                              return (
                                <div key={role.name} className="space-y-2">
                                  <div className="flex items-center justify-between">
                                    <div className="flex items-center gap-2">
                                      <span className="text-2xl">{role.emoji}</span>
                                      <span className="font-semibold text-gray-800">{role.name}</span>
                                    </div>
                                    <div className="text-right">
                                      <div className="text-sm text-gray-600">{role.count} tasks</div>
                                      <div className="text-lg font-bold text-gray-800">{role.totalHours.toFixed(1)}h</div>
                                    </div>
                                  </div>
                                  <div className="relative w-full h-3 bg-gray-200 rounded-full overflow-hidden">
                                    <div
                                      className="absolute top-0 left-0 h-full bg-gradient-to-r from-purple-500 to-blue-500 transition-all"
                                      style={{ width: `${percentage}%` }}
                                    />
                                  </div>
                                  <div className="text-xs text-gray-500 text-right">{percentage}% of total time</div>
                                </div>
                              );
                            })}
                          </div>
                        </div>

                        {/* Recent Tasks */}
                        <div>
                          <h2 className="text-xl font-bold text-gray-800 mb-4">Recent Tasks</h2>
                          <div className="space-y-2">
                            {monthlyTasks.slice(-5).reverse().map(task => (
                              <div key={task.id} className="flex items-center justify-between p-4 bg-white border border-gray-200 rounded-xl hover:border-purple-300 transition">
                                <div className="flex items-center gap-3">
                                  <span className="text-2xl">{task.role.emoji}</span>
                                  <div>
                                    <div className="font-medium text-gray-800">{task.task}</div>
                                    <div className="text-sm text-gray-500">
                                      {new Date(task.scheduledDate).toLocaleDateString()} ‚Ä¢ {task.duration}h
                                    </div>
                                  </div>
                                </div>
                                <span className={`px-3 py-1 rounded-full text-sm ${task.role.color}`}>
                                  {task.role.name}
                                </span>
                              </div>
                            ))}
                          </div>
                        </div>

                        {/* Monthly Insights with AI */}
                        <div className="bg-gradient-to-br from-purple-50 to-blue-50 p-6 rounded-2xl">
                          <div className="flex items-center justify-between mb-4">
                            <h2 className="text-xl font-bold text-gray-800">ü§ñ AI Monthly Insights</h2>
                            <button
                              onClick={generateMonthlyInsight}
                              disabled={generatingInsight || !claudeApiKey}
                              className={`px-4 py-2 rounded-xl font-semibold transition ${
                                generatingInsight
                                  ? 'bg-gray-300 text-gray-500 cursor-wait'
                                  : claudeApiKey
                                  ? 'bg-purple-500 text-white hover:bg-purple-600'
                                  : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                              }`}
                            >
                              {generatingInsight ? 'Analyzing...' : 'Generate Insights'}
                            </button>
                          </div>

                          {!claudeApiKey && (
                            <div className="bg-yellow-50 border border-yellow-200 rounded-xl p-4 text-sm text-yellow-800">
                              ‚ö†Ô∏è Configure your Claude API key in Settings to generate AI insights
                            </div>
                          )}

                          {monthlyInsight && (
                            <div className="space-y-4">
                              {/* Keywords */}
                              <div>
                                <div className="text-sm font-semibold text-gray-700 mb-2">üè∑Ô∏è Top Keywords</div>
                                <div className="flex flex-wrap gap-2">
                                  {monthlyInsight.keywords.map((keyword, idx) => (
                                    <span
                                      key={idx}
                                      className="px-3 py-1 bg-white border border-purple-200 rounded-full text-sm font-medium text-purple-700"
                                    >
                                      {keyword}
                                    </span>
                                  ))}
                                </div>
                              </div>

                              {/* User Profile */}
                              <div className="bg-white p-4 rounded-xl">
                                <div className="text-sm font-semibold text-gray-700 mb-2">üë§ Your Profile This Month</div>
                                <p className="text-gray-700">{monthlyInsight.profile}</p>
                              </div>

                              {/* Recommendation */}
                              <div className="bg-gradient-to-r from-green-50 to-blue-50 p-4 rounded-xl border border-green-200">
                                <div className="text-sm font-semibold text-green-700 mb-2">üí° Recommendation</div>
                                <p className="text-gray-700">{monthlyInsight.recommendation}</p>
                              </div>
                            </div>
                          )}
                        </div>
                      </div>
                    )}
                  </div>
                </div>
              </div>
            );
          }
        }

        ReactDOM.render(<SparkApp />, document.getElementById('root'));
    </script>
</body>
</html>
